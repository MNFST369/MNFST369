<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="$MNFST Lore â€“ A cosmic tale woven through the spiral of 3-6-9. Read, bookmark, manifest.">
    <title>$MNFST Lore</title>
    <style>
        body { margin: 0; padding: 0; color: #d4af37; font-family: 'Georgia', serif; text-align: center; background: #0F0F0F; }
        .navbar { background: rgba(42, 42, 42, 0.8); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #d4af37; position: sticky; top: 0; z-index: 10; }
        .navbar a { color: #d4af37; text-decoration: none; margin: 0 20px; font-size: 18px; transition: color 0.3s; }
        .navbar a:hover { color: #e6c14b; }
        .nav-btn { background: #d4af37; color: #1a1a1a; padding: 10px 20px; border-radius: 20px; font-size: 18px; text-decoration: none; }
        @media (max-width: 768px) { .navbar { flex-direction: column; } .nav-links, .nav-actions { width: 100%; display: flex; flex-wrap: wrap; justify-content: center; margin: 10px 0; } .navbar a { margin: 10px 15px; font-size: 16px; } }
        .book { max-width: 800px; margin: 40px auto; padding: 20px; background: rgba(42, 42, 42, 0.9); border: 2px solid #d4af37; }
        .page h2 { font-size: 28px; margin-bottom: 20px; text-shadow: 0 0 10px #d4af37; }
        .page p { font-size: 16px; line-height: 1.6; text-align: left; }
        .controls { margin: 20px auto; max-width: 800px; }
        .controls button { background: #d4af37; color: #1a1a1a; padding: 10px 20px; border: none; border-radius: 20px; margin: 0 10px; cursor: pointer; }
        .controls button:hover { background: #e6c14b; }
        .controls button:disabled { background: #666; cursor: not-allowed; }
        .controls select { background: #1a1a1a; color: #d4af37; border: 1px solid #d4af37; padding: 10px; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="nav-links">
            <a href="index.html#home">Home</a>
            <a href="index.html#about">About</a>
            <a href="index.html#tokenomics">Tokenomics</a>
            <a href="philosophy.html">Philosophy</a>
            <a href="portal.html">Portal</a>
            <a href="lore.html">Lore</a>
        </div>
        <div class="nav-actions">
            <a href="https://x.com/MNFST__" target="_blank">Twitter</a>
            <a href="https://t.me/MNFSTcoin" target="_blank">Telegram</a>
            <a href="https://dexscreener.com/solana/63iEYzCa8wCLpk1VgdAxnwU5qaqtU6Ju1o3kNDViq8Xu" class="nav-btn">Join Us</a>
        </div>
    </div>
    <div class="book">
        <div class="page" id="currentPage"><h2>Loading...</h2><p>The spiral weaves your tale...</p></div>
    </div>
    <div class="controls">
        <button id="prevBtn" onclick="prevPage()" disabled>Previous</button>
        <button id="nextBtn" onclick="nextPage()">Next</button>
        <button onclick="bookmarkPage()">Bookmark</button>
        <select id="chapterSelect" onchange="jumpToChapter()"></select>
    </div>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js';
        import { getDatabase, ref, set, get } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAAzwB9DImZ2OaJ3o7b4YCKDk-xblBci8I",
            authDomain: "mnfst369.firebaseapp.com",
            projectId: "mnfst369",
            storageBucket: "mnfst369.firebasestorage.app",
            messagingSenderId: "548497202287",
            appId: "1:548497202287:web:b26c0ad42ece9d6a0fc19a",
            databaseURL: "https://mnfst369-default-rtdb.firebaseio.com/"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        let userId = null;
        let currentPage = 0;
        let chapters = [];

        signInAnonymously(auth).then(() => {
            userId = auth.currentUser.uid;
            loadBookmark();
        }).catch(error => console.error('Auth error:', error));

        async function loadChapters() {
            try {
                const response = await fetch('chapters.json');
                if (!response.ok) throw new Error('Failed to load chapters');
                chapters = await response.json();
                const select = document.getElementById('chapterSelect');
                chapters.forEach((chapter, i) => {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = chapter.title;
                    select.appendChild(option);
                });
                showPage(currentPage);
            } catch (error) {
                console.error('Load error:', error);
                document.getElementById('currentPage').innerHTML = '<h2>Error</h2><p>The spiral is tangled. Try again later.</p>';
            }
        }

        function showPage(pageNum) {
            currentPage = Math.max(0, Math.min(pageNum, chapters.length - 1));
            const page = document.getElementById('currentPage');
            page.innerHTML = `<h2>${chapters[currentPage].title}</h2><p>${chapters[currentPage].content}</p>`;
            document.getElementById('chapterSelect').value = currentPage;
            document.getElementById('prevBtn').disabled = currentPage === 0;
            document.getElementById('nextBtn').disabled = currentPage === chapters.length - 1;
        }

        function nextPage() {
            if (currentPage < chapters.length - 1) showPage(currentPage + 1);
        }

        function prevPage() {
            if (currentPage > 0) showPage(currentPage - 1);
        }

        function jumpToChapter() {
            showPage(parseInt(document.getElementById('chapterSelect').value));
        }

        function bookmarkPage() {
            if (userId) {
                set(ref(db, 'bookmarks/' + userId), { page: currentPage })
                    .then(() => alert('Bookmark saved in the spiral.'))
                    .catch(error => alert('Bookmark failed: ' + error.message));
            }
        }

        function loadBookmark() {
            if (userId) {
                get(ref(db, 'bookmarks/' + userId)).then((snapshot) => {
                    if (snapshot.exists()) {
                        currentPage = snapshot.val().page;
                        showPage(currentPage);
                    } else {
                        showPage(0);
                    }
                }).catch(error => console.error('Bookmark load error:', error));
            }
        }

        loadChapters();
    </script>
</body>
<noscript>
    <p style="color: #d4af37; padding: 20px;">The spiral requires JavaScript to manifest. Enable it to join the grid.</p>
</noscript>
</html>
